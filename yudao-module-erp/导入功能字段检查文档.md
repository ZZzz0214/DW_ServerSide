# ERP系统导入功能字段完整检查文档

**📅 文档生成日期：** 2025-12-15  
**🔍 检查范围：** yudao-module-erp模块所有导入和导入更新功能  
**✅ 检查内容：** 每个模块的导入字段、导入更新字段及逻辑正确性  

---

## 📋 文档说明

本文档详细列出了每个模块的：
1. **导入字段清单** - Excel可导入的所有字段
2. **导入创建逻辑** - 创建新记录时的字段处理
3. **导入更新逻辑** - 更新现有记录时的字段处理
4. **逻辑正确性评估** - 是否存在数据丢失风险

---

## ⚠️ 重要修复说明

### 修复的问题

**问题描述：** 当导入Excel表格不包含某些列时，这些未包含的字段在数据库中的现有数据会被清空。

**典型场景：**
- 数据库记录有：`售后状况 = "待处理"`、`中转人员 = "张三"`
- 导入Excel只包含`中转人员`列，不包含`售后状况`列
- 修复前：`中转人员`正常更新，但`售后状况`被清空 ❌
- 修复后：`中转人员`正常更新，`售后状况`保持原值 ✅

### 修复的模块和方法

**代发订单模块（ErpDistributionServiceImpl）：**
1. ✅ `importDistributionList` - 修复了comboProductId和transferPerson的null判断
2. ✅ `importSaleAuditList` - 修复了所有字段的null判断（特别是afterSalesStatus和transferPerson）
3. ✅ `importPurchaseAuditList` - 修复了所有字段的null判断（特别是afterSalesStatus）
4. ✅ `importLogisticsList` - 修复了logisticsCompany和trackingNumber的null判断

**修复策略：** 所有字段更新前都进行null/空值判断，只更新导入文件中提供的非空字段。

---

---

## 1. 【代发订单】ErpDistributionServiceImpl

### 主导入方法：importDistributionList

#### 导入字段清单（17个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 订单编号 | String | 业务编号（唯一标识） |
| 2 | orderNumber | 订单号 | String | 外部订单号 |
| 3 | logisticsCompany | 物流公司 | String | 物流公司名称 |
| 4 | trackingNumber | 物流单号 | String | 物流追踪号 |
| 5 | receiverName | 收件姓名 | String | 收件人姓名 |
| 6 | receiverPhone | 联系电话 | String | 联系电话 |
| 7 | receiverAddress | 详细地址 | String | 收件地址 |
| 8 | originalProductName | 原表商品 | String | 原始商品名称 |
| 9 | originalStandard | 原表规格 | String | 原始规格 |
| 10 | originalQuantity | 原表数量 | Integer | 原始数量 |
| 11 | remark | 备注信息 | String | 备注 |
| 12 | comboProductNo | 组品编号 | String | 组品业务编号 |
| 13 | productSpecification | 产品规格 | String | 产品规格 |
| 14 | productQuantity | 产品数量 | Integer | 产品数量 |
| 15 | salesperson | 销售人员 | String | 销售人员 |
| 16 | customerName | 客户名称 | String | 客户名称 |
| 17 | transferPerson | 中转人员 | String | 中转人员 |

#### 导入创建逻辑
- ✅ **正确** - 使用所有导入字段创建新记录
- 🔍 **特殊处理：**
  - comboProductNo → 转换为comboProductId
  - 自动生成distributionNo业务编号

#### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新，只更新非空字段
- 📋 **更新字段：**
  - orderNumber（订单号）
  - logisticsCompany（物流公司）
  - trackingNumber（物流单号）
  - receiverName（收件姓名）
  - receiverPhone（联系电话）
  - receiverAddress（详细地址）
  - originalProductName（原表商品）
  - originalStandard（原表规格）
  - originalQuantity（原表数量）
  - remark（备注信息）
  - productQuantity（产品数量）
  - salesperson（销售人员）
  - customerName（客户名称）
  - transferPerson（中转人员）
  - comboProductId（组品ID，仅当comboProductNo不为空时更新）

#### 逻辑正确性评估
✅ **完全正确** - 已修复comboProductId和transferPerson的null判断，不会清空未导入的字段

---

### 销售审核导入方法：importSaleAuditList

#### 导入字段清单（5个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 订单编号 | String | 业务编号（唯一标识） |
| 2 | saleOtherFees | 出货杂费 | BigDecimal | 销售杂费 |
| 3 | afterSalesStatus | 售后状况 | String | 售后状态 |
| 4 | saleAfterSalesAmount | 出货售后金额 | BigDecimal | 售后金额 |
| 5 | transferPerson | 中转人员 | String | 中转人员 |

#### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新，只更新非空字段
- 📋 **更新字段：**
  - saleOtherFees（出货杂费，仅当不为null时更新）
  - saleAfterSalesAmount（出货售后金额，仅当不为null时更新）
  - afterSalesStatus（售后状况，仅当不为空时更新）⚠️ **关键修复**
  - transferPerson（中转人员，仅当不为空时更新）⚠️ **关键修复**
  - afterSalesTime（售后时间，**仅当售后状态发生变化时更新**）✅ **智能更新**

**售后时间更新逻辑：**
- ✅ 如果导入的售后状态与数据库中的状态**不同**，更新售后状态和售后时间
- ✅ 如果导入的售后状态与数据库中的状态**相同**，不更新售后时间（保持原值）
- ✅ 如果导入的售后状态为**空**，不更新售后状态和售后时间

#### 逻辑正确性评估
✅ **完全正确** - 已修复所有字段的null判断，**不会清空售后状况和中转人员字段**

---

### 采购审核导入方法：importPurchaseAuditList

#### 导入字段清单（4个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 订单编号 | String | 业务编号（唯一标识） |
| 2 | otherFees | 采购杂费 | BigDecimal | 采购杂费 |
| 3 | afterSalesStatus | 售后状况 | String | 售后状态 |
| 4 | purchaseAfterSalesAmount | 采购售后金额 | BigDecimal | 售后金额 |

#### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新，只更新非空字段
- 📋 **更新字段：**
  - purchaseOtherFees（采购杂费，仅当不为null时更新）
  - purchaseAfterSalesAmount（采购售后金额，仅当不为null时更新）
  - afterSalesStatus（售后状况，仅当不为空时更新）⚠️ **关键修复**
  - afterSalesTime（售后时间，**仅当售后状态发生变化时更新**）✅ **智能更新**

**售后时间更新逻辑：**
- ✅ 如果导入的售后状态与数据库中的状态**不同**，更新售后状态和售后时间
- ✅ 如果导入的售后状态与数据库中的状态**相同**，不更新售后时间（保持原值）
- ✅ 如果导入的售后状态为**空**，不更新售后状态和售后时间

#### 逻辑正确性评估
✅ **完全正确** - 已修复所有字段的null判断，**不会清空售后状况字段**

---

### 物流导入方法：importLogisticsList

#### 导入字段清单（3个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 订单编号 | String | 业务编号（唯一标识） |
| 2 | logisticsCompany | 物流公司 | String | 物流公司 |
| 3 | trackingNumber | 物流单号 | String | 物流单号 |
| 4 | purchaseRemark | 采购备注 | String | 采购备注（可选） |

#### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新，只更新非空字段
- 📋 **更新字段：**
  - logisticsCompany（物流公司，仅当不为空时更新）⚠️ **关键修复**
  - trackingNumber（物流单号，仅当不为空时更新）⚠️ **关键修复**
  - purchaseRemark（采购备注，仅当不为空时更新）

#### 逻辑正确性评估
✅ **完全正确** - 已修复所有字段的null判断，不会清空未导入的字段

---

## 2. 【批发订单】ErpWholesaleServiceImpl

### 导入字段清单（12个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 订单编号 | String | 业务编号（唯一标识） |
| 2 | logisticsNumber | 物流单号 | String | 物流追踪号 |
| 3 | receiverName | 收件姓名 | String | 收件人姓名 |
| 4 | receiverPhone | 联系电话 | String | 联系电话 |
| 5 | receiverAddress | 详细地址 | String | 收件地址 |
| 6 | remark | 备注信息 | String | 备注 |
| 7 | comboProductNo | 组品编号 | String | 组品业务编号 |
| 8 | productSpecification | 产品规格 | String | 产品规格 |
| 9 | productQuantity | 产品数量 | Integer | 产品数量 |
| 10 | salesperson | 销售人员 | String | 销售人员 |
| 11 | customerName | 客户名称 | String | 客户名称 |
| 12 | transferPerson | 中转人员 | String | 中转人员 |

### 导入创建逻辑
- ✅ **正确** - 使用所有导入字段创建新记录
- 🔍 **特殊处理：**
  - comboProductNo → 转换为comboProductId
  - 自动生成wholesaleNo业务编号

### 导入更新逻辑
- ✅ **正确** - 复制现有记录后逐字段更新
- 📋 **更新字段：**
  - logisticsNumber（物流单号）
  - receiverName（收件姓名）
  - receiverPhone（联系电话）
  - receiverAddress（详细地址）
  - salesperson（销售人员）
  - transferPerson（中转人员）
  - remark（备注信息）
  - comboProductId（组品ID，仅当comboProductNo不为空时更新）
  - productSpecification（产品规格）
  - productQuantity（产品数量）
  - customerName（客户名称）

**代码位置：** `ErpWholesaleServiceImpl.java` 第1230-1269行

### 逻辑正确性评估
✅ **完全正确** - 不会清空未导入的字段

---

## 3. 【代发辅助】ErpDropshipAssistServiceImpl

### 导入字段清单（8个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | originalProduct | 原表商品 | String | 原始商品 |
| 3 | originalSpec | 原表规格 | String | 原始规格 |
| 4 | originalQuantity | 原表数量 | Integer | 原始数量 |
| 5 | comboProductId | 组品编号 | String | 组品业务编号 |
| 6 | productSpec | 产品规格 | String | 产品规格 |
| 7 | productQuantity | 产品数量 | Integer | 产品数量 |
| 8 | remark | 备注信息 | String | 备注 |
| 9 | status | 状态信息 | String | 状态（字典） |

### 导入创建逻辑
- ✅ **正确** - 使用所有导入字段创建新记录
- 🔍 **特殊处理：**
  - 自动生成业务编号

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：**
  - originalProduct（原表商品）
  - originalSpec（原表规格）
  - originalQuantity（原表数量）
  - comboProductId（组品编号）
  - productSpec（产品规格）
  - productQuantity（产品数量）
  - remark（备注信息）
  - status（状态信息）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 4. 【财务表】ErpFinanceServiceImpl

### 导入字段清单（8个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | billName | 账单名称 | String | 账单名称 |
| 3 | amount | 收付金额 | BigDecimal | 金额 |
| 4 | incomeExpense | 收入支出 | Integer | 收入/支出（字典） |
| 5 | category | 收付类目 | String | 类目（字典） |
| 6 | account | 收付账号 | String | 账号（转换器） |
| 7 | status | 账单状态 | Integer | 状态（字典） |
| 8 | remark | 备注信息 | String | 备注 |
| 9 | orderDate | 下单日期 | LocalDate | 下单日期 |

### 导入创建逻辑
- ✅ **正确** - 使用所有导入字段创建新记录
- 🔍 **特殊处理：**
  - 通过convertImportVOToDO转换

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：**
  - billName（账单名称）
  - amount（收付金额）
  - incomeExpense（收入支出）
  - category（收付类目）
  - account（收付账号）
  - status（账单状态）
  - remark（备注信息）
  - orderDate（下单日期）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 5. 【产品信息】ErpProductServiceImpl

### 导入字段清单（40个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 产品编号 | String | 业务编号（唯一标识） |
| 2 | name | 产品名称 | String | 产品名称 |
| 3 | productShortName | 产品简称 | String | 产品简称 |
| 4 | shippingCode | 发货编码 | String | 发货编码 |
| 5 | standard | 产品规格 | String | 产品规格 |
| 6 | productionDate | 产品日期 | LocalDateTime | 产品日期 |
| 7 | expiryDay | 保质日期 | Integer | 保质期天数 |
| 8 | brand | 品牌名称 | String | 品牌（字典） |
| 9 | categoryId | 产品品类 | String | 品类（字典转换为ID） |
| 10 | status | 产品状态 | String | 状态（字典） |
| 11 | productSellingPoints | 产品卖点 | String | 卖点 |
| 12 | purchaser | 采购人员 | String | 采购人员 |
| 13 | supplier | 供应商名 | String | 供应商 |
| 14 | purchasePrice | 采购单价 | BigDecimal | 采购单价 |
| 15 | wholesalePrice | 批发单价 | BigDecimal | 批发单价 |
| 16 | remark | 备注信息 | String | 备注 |
| 17 | minPurchasePrice | 对外最低出货单价 | String | 最低价 |
| 18-40 | 运费相关字段等 | ... | ... | 运费类型、固定运费、按件运费等 |

### 导入创建逻辑
- ✅ **正确** - 使用convertImportVOToDO转换后创建
- 🔍 **特殊处理：**
  - categoryId字典值转换为ID
  - 自动生成业务编号

### 导入更新逻辑
- ✅ **已修复** - 复制现有记录 + convertImportVOToDO + 逐字段判断更新
- 📋 **更新字段：** 28个字段（包括name, productShortName, standard, brand, purchaser等）

### 逻辑正确性评估
✅ **完全正确** - 已修复字段名错误（shortName→productShortName, spec→standard），不会清空未导入的字段

---

## 6. 【组品信息】ErpComboProductServiceImpl

### 导入字段清单（13个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 组品编号 | String | 业务编号（唯一标识） |
| 2 | itemsString | 单品组品 | String | 产品编号,数量;... |
| 3 | shortName | 产品简称 | String | 产品简称 |
| 4 | shippingCode | 发货编码 | String | 发货编码 |
| 5 | purchaser | 采购人员 | String | 采购人员 |
| 6 | supplier | 供应商名 | String | 供应商 |
| 7 | remark | 备注信息 | String | 备注 |
| 8 | shippingFeeType | 运费类型 | Integer | 0-固定,1-按件,2-按重 |
| 9 | fixedShippingFee | 固定运费 | BigDecimal | 固定运费 |
| 10 | additionalItemQuantity | 按件数量 | Integer | 按件数量 |
| 11 | additionalItemPrice | 按件价格 | BigDecimal | 按件价格 |
| 12 | firstWeight | 首重重量 | BigDecimal | 首重重量 |
| 13 | firstWeightPrice | 首重价格 | BigDecimal | 首重价格 |
| 14 | additionalWeight | 续重重量 | BigDecimal | 续重重量 |
| 15 | additionalWeightPrice | 续重价格 | BigDecimal | 续重价格 |

### 导入创建逻辑
- ✅ **正确** - 创建新组品记录
- 🔍 **特殊处理：**
  - itemsString解析为组品项（productNo,quantity;...）
  - 自动计算组品价格和名称

### 导入更新逻辑
- ✅ **已修复** - 复制现有记录后逐字段更新
- 📋 **更新字段：**
  - shortName（产品简称）
  - shippingCode（发货编码）
  - purchaser（采购人员）
  - supplier（供应商名）
  - remark（备注信息）
  - 运费相关字段（7个）
  - itemsString（会重新计算价格和名称）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 7. 【订货库存】ErpInventoryServiceImpl

### 导入字段清单（3个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 库存编号 | String | 业务编号（唯一标识） |
| 2 | productNo | 产品编号 | String | 产品业务编号 |
| 3 | spotInventory | 现货库存 | Integer | 现货数量 |
| 4 | remark | 备注信息 | String | 备注 |

### 导入创建逻辑
- ✅ **正确** - 使用convertImportVOToDO转换后创建
- 🔍 **特殊处理：**
  - productNo → 转换为productId
  - remainingInventory设置为null（查询时计算）

### 导入更新逻辑
- ✅ **已修复** - 复制现有记录 + convertImportVOToDO + 逐字段判断更新
- 📋 **更新字段：**
  - productId（产品ID）
  - spotInventory（现货库存）
  - remark（备注信息）

### 逻辑正确性评估
✅ **完全正确** - 已修复字段名错误（删除不存在的initialInventory等），不会清空未导入的字段

---

## 8. 【样品表】ErpSampleServiceImpl

### 导入字段清单（12个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | logisticsCompany | 物流公司 | String | 物流公司 |
| 3 | logisticsNo | 物流单号 | String | 物流单号 |
| 4 | receiverName | 收件姓名 | String | 收件人 |
| 5 | contactPhone | 联系电话 | String | 电话 |
| 6 | address | 详细地址 | String | 地址 |
| 7 | remark | 备注信息 | String | 备注 |
| 8 | comboProductId | 组品编号 | String | 组品业务编号 |
| 9 | productSpec | 产品规格 | String | 产品规格 |
| 10 | productQuantity | 产品数量 | Integer | 产品数量 |
| 11 | customerName | 客户名称 | String | 客户名称 |
| 12 | sampleStatus | 样品状态 | Integer | 状态（字典） |

### 导入创建逻辑
- ✅ **正确** - 使用convertImportVOToDO转换后创建
- 🔍 **特殊处理：**
  - comboProductId（业务编号）→ 转换为组品ID

### 导入更新逻辑
- ✅ **已修复** - 复制现有记录 + convertImportVOToDO + 逐字段判断更新
- 📋 **更新字段：** 全部11个字段

### 逻辑正确性评估
✅ **完全正确** - 已修复字段名错误（删除不存在的productName），不会清空未导入的字段

---

## 9. 【记事本】ErpNotebookServiceImpl

### 导入字段清单（5个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | taskName | 任务名称 | String | 任务名称 |
| 3 | taskStatus | 任务状态 | Integer | 状态（字典） |
| 4 | taskPerson | 任务人员 | String | 负责人（字典） |
| 5 | remark | 备注信息 | String | 备注 |

### 导入创建逻辑
- ✅ **正确** - 使用convertImportVOToDO转换后创建

### 导入更新逻辑
- ✅ **已修复** - 复制现有记录 + convertImportVOToDO + 逐字段判断更新
- 📋 **更新字段：**
  - taskName（任务名称）
  - taskStatus（任务状态）
  - taskPerson（任务人员）
  - remark（备注信息）

### 逻辑正确性评估
✅ **完全正确** - 已修复字段名错误（删除不存在的taskContent），不会清空未导入的字段

---

## 10. 【中转销售】ErpTransitSaleServiceImpl

### 导入字段清单（12个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | groupProductNo | 组品编号 | String | 组品业务编号 |
| 3 | transitPerson | 中转人员 | String | 中转人员（字典） |
| 4 | distributionPrice | 代发单价 | BigDecimal | 代发单价 |
| 5 | wholesalePrice | 批发单价 | BigDecimal | 批发单价 |
| 6 | remark | 备注信息 | String | 备注 |
| 7-12 | 运费相关字段 | ... | ... | 运费类型等 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录
- 🔍 **特殊处理：**
  - groupProductNo → 转换为comboProductId

### 导入更新逻辑
- ✅ **正确** - 只更新提供的字段
- 📋 **更新字段：**
  - transitPerson（中转人员）
  - distributionPrice（代发单价）
  - wholesalePrice（批发单价）
  - 运费相关字段
  - remark（备注信息）

### 逻辑正确性评估
✅ **完全正确** - 不会清空未导入的字段

---

## 11. 【销售价格】ErpSalePriceServiceImpl

### 导入字段清单（13个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | groupProductNo | 组品编号 | String | 组品业务编号 |
| 3 | customerName | 客户名称 | String | 客户名称 |
| 4 | distributionPrice | 代发单价 | BigDecimal | 代发单价 |
| 5 | wholesalePrice | 批发单价 | BigDecimal | 批发单价 |
| 6 | remark | 备注信息 | String | 备注 |
| 7-13 | 运费相关字段 | ... | ... | 运费类型等 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录
- 🔍 **特殊处理：**
  - groupProductNo → 转换为comboProductId
  - customerName → 转换为customerId

### 导入更新逻辑
- ✅ **正确** - 只更新提供的字段
- 📋 **更新字段：**
  - distributionPrice（代发单价）
  - wholesalePrice（批发单价）
  - 运费相关字段
  - remark（备注信息）

### 逻辑正确性评估
✅ **完全正确** - 不会清空未导入的字段

---

## 12. 【团购货盘】ErpGroupBuyingServiceImpl

### 导入字段清单（24个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | brandName | 品牌名称 | String | 品牌（字典） |
| 3 | productName | 产品名称 | String | 产品名称 |
| 4 | productSpec | 产品规格 | String | 产品规格 |
| 5 | productSku | 产品SKU | String | SKU |
| 6 | marketPrice | 市场价格 | BigDecimal | 市场价 |
| 7 | shelfLife | 保质日期 | LocalDateTime | 保质期 |
| 8 | productStock | 产品库存 | Integer | 库存 |
| 9 | remark | 备注信息 | String | 备注 |
| 10 | corePrice | 核心价格 | BigDecimal | 核心价 |
| 11 | distributionPrice | 分发价格 | BigDecimal | 分发价 |
| 12 | supplyGroupPrice | 供团价格 | BigDecimal | 供团价 |
| 13 | sellingCommission | 帮卖佣金 | BigDecimal | 佣金 |
| 14 | groupPrice | 开团价格 | BigDecimal | 开团价 |
| 15 | groupMechanism | 开团机制 | String | 机制 |
| 16 | expressFee | 快递费用 | BigDecimal | 快递费 |
| 17-24 | 其他字段 | ... | ... | 天猫京东、数据等 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录
- 🔍 **特殊处理：**
  - 自动计算渠道毛利

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：** 全部24个字段
- 🔍 **特殊处理：**
  - 自动重新计算渠道毛利

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 13. 【团购复盘】ErpGroupBuyingReviewServiceImpl

### 导入字段清单（10个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | groupBuyingId | 团购货盘表编号 | String | 关联货盘编号 |
| 3 | remark | 备注信息 | String | 备注 |
| 4 | customerName | 客户名称 | String | 客户名称 |
| 5 | supplyGroupPrice | 供团价格 | BigDecimal | 供团价 |
| 6 | expressFee | 快递费用 | BigDecimal | 快递费 |
| 7 | sampleSendDate | 寄样日期 | LocalDate | 寄样日期 |
| 8 | groupStartDate | 开团日期 | LocalDate | 开团日期 |
| 9 | groupSales | 开团销量 | Integer | 销量 |
| 10 | repeatGroupDate | 复团日期 | LocalDate | 复团日期 |
| 11 | reviewStatus | 复盘状态 | String | 状态 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录
- 🔍 **特殊处理：**
  - groupBuyingId → 转换为货盘ID
  - customerName → 转换为customerId

### 导入更新逻辑
- ✅ **正确** - 保持原值策略（Excel为null时不更新）
- 📋 **更新字段：** 只更新Excel中非null的字段

### 逻辑正确性评估
✅ **完全正确** - 不会清空未导入的字段

---

## 14. 【团购信息】ErpGroupBuyingInfoServiceImpl

### 导入字段清单（11个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | customerName | 客户名称 | String | 客户名称 |
| 3 | customerPosition | 客户职位 | String | 职位（字典） |
| 4 | customerWechat | 客户微信 | String | 微信号 |
| 5 | platformName | 平台名称 | String | 平台（字典） |
| 6 | customerAttribute | 客户属性 | String | 属性（字典） |
| 7 | customerCity | 客户城市 | String | 城市（字典） |
| 8 | customerDistrict | 客户区县 | String | 区县（字典） |
| 9 | userPortrait | 用户画像 | String | 画像 |
| 10 | recruitmentCategory | 招商类目 | String | 类目 |
| 11 | selectionCriteria | 选品标准 | String | 标准 |
| 12 | remark | 备注信息 | String | 备注 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：** 全部11个字段

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 15. 【私播货盘】ErpPrivateBroadcastingServiceImpl

### 导入字段清单（19个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | brandName | 品牌名称 | String | 品牌（字典） |
| 3 | productName | 产品名称 | String | 产品名称 |
| 4 | productSpec | 产品规格 | String | 产品规格 |
| 5 | productSku | 产品SKU | String | SKU |
| 6 | marketPrice | 市场价格 | BigDecimal | 市场价 |
| 7 | shelfLife | 保质日期 | LocalDateTime | 保质期 |
| 8 | productStock | 产品库存 | Integer | 库存 |
| 9 | remark | 备注信息 | String | 备注 |
| 10 | livePrice | 直播价格 | BigDecimal | 直播价 |
| 11 | productNakedPrice | 产品裸价 | BigDecimal | 裸价 |
| 12 | expressFee | 快递费用 | BigDecimal | 快递费 |
| 13 | dropshipPrice | 代发价格 | BigDecimal | 代发价 |
| 14 | publicLink | 公域链接 | String | 链接 |
| 15 | coreSellingPoint | 核心卖点 | String | 卖点 |
| 16 | expressCompany | 快递公司 | String | 快递公司 |
| 17 | shippingTime | 发货时效 | String | 时效 |
| 18 | shippingArea | 发货地区 | String | 地区 |
| 19 | privateStatus | 私播货盘状态 | String | 状态（字典） |

### 导入创建逻辑
- ✅ **正确** - 创建新记录

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：** productName和privateStatus（2个字段）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 16. 【私播复盘】ErpPrivateBroadcastingReviewServiceImpl

### 导入字段清单（13个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | privateBroadcastingNo | 私播货盘编号 | String | 关联货盘编号 |
| 3 | remark | 备注信息 | String | 备注 |
| 4 | customerName | 客户名称 | String | 客户名称 |
| 5 | productNakedPrice | 产品裸价 | BigDecimal | 裸价 |
| 6 | expressFee | 快递费用 | BigDecimal | 快递费 |
| 7 | dropshipPrice | 代发价格 | BigDecimal | 代发价 |
| 8 | sampleSendDate | 寄样日期 | LocalDate | 寄样日期 |
| 9 | groupStartDate | 开团日期 | LocalDate | 开团日期 |
| 10 | groupSales | 开团销量 | Integer | 销量 |
| 11 | repeatGroupDate | 复团日期 | LocalDate | 复团日期 |
| 12 | reviewStatus | 复盘状态 | String | 状态 |
| 13 | livePrice | 直播价格 | BigDecimal | 直播价 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录
- 🔍 **特殊处理：**
  - privateBroadcastingNo → 转换为货盘ID
  - customerName → 转换为customerId

### 导入更新逻辑
- ✅ **已修复** - 只更新关联ID字段
- 📋 **更新字段：**
  - customerId（客户ID）
  - privateBroadcastingId（私播货盘ID）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 17. 【私播信息】ErpPrivateBroadcastingInfoServiceImpl

### 导入字段清单（11个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | customerName | 客户姓名 | String | 客户姓名 |
| 3 | customerPosition | 客户职位 | String | 职位（字典） |
| 4 | customerWechat | 客户微信 | String | 微信号 |
| 5 | platformName | 平台名称 | String | 平台（字典） |
| 6 | customerAttribute | 客户属性 | String | 属性（字典） |
| 7 | customerCity | 客户城市 | String | 城市（字典） |
| 8 | customerDistrict | 客户区县 | String | 区县（字典） |
| 9 | userPortrait | 用户画像 | String | 画像 |
| 10 | recruitmentCategory | 招商类目 | String | 类目 |
| 11 | selectionCriteria | 选品标准 | String | 标准 |
| 12 | remark | 备注信息 | String | 备注 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：** 全部11个字段
  - customerName（客户姓名）
  - customerPosition（客户职位）
  - customerWechat（客户微信）
  - platformName（平台名称）
  - customerAttribute（客户属性）
  - customerCity（客户城市）
  - customerDistrict（客户区县）
  - userPortrait（用户画像）
  - recruitmentCategory（招商类目）
  - selectionCriteria（选品标准）
  - remark（备注信息）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 18. 【直播货盘】ErpLiveBroadcastingServiceImpl

### 导入字段清单（19个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | brandName | 品牌名称 | String | 品牌（字典） |
| 3 | productName | 产品名称 | String | 产品名称 |
| 4 | productSpec | 产品规格 | String | 产品规格 |
| 5 | productSku | 产品SKU | String | SKU |
| 6 | marketPrice | 市场价格 | BigDecimal | 市场价 |
| 7 | shelfLife | 保质日期 | LocalDate | 保质期 |
| 8 | productStock | 产品库存 | Integer | 库存 |
| 9 | coreSellingPoint | 核心卖点 | String | 卖点 |
| 10 | remark | 备注信息 | String | 备注 |
| 11 | livePrice | 直播价格 | String | 直播价 |
| 12 | liveCommission | 直播佣金 | BigDecimal | 直播佣金 |
| 13 | publicCommission | 公开佣金 | BigDecimal | 公开佣金 |
| 14 | rebateCommission | 返点佣金 | BigDecimal | 返点佣金 |
| 15 | expressCompany | 快递公司 | String | 快递公司 |
| 16 | shippingTime | 发货时效 | String | 时效 |
| 17 | shippingArea | 发货地区 | String | 地区 |
| 18 | liveStatus | 直播货盘状态 | String | 状态（字典） |

### 导入创建逻辑
- ✅ **正确** - 创建新记录

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：** 全部17个字段
  - brandName（品牌名称）
  - productName（产品名称）
  - productSpec（产品规格）
  - productSku（产品SKU）
  - marketPrice（市场价格）
  - shelfLife（保质日期）
  - productStock（产品库存）
  - coreSellingPoint（核心卖点）
  - remark（备注信息）
  - livePrice（直播价格）
  - liveCommission（直播佣金）
  - publicCommission（公开佣金）
  - rebateCommission（返点佣金）
  - expressCompany（快递公司）
  - shippingTime（发货时效）
  - shippingArea（发货地区）
  - liveStatus（直播货盘状态）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 19. 【直播复盘】ErpLiveBroadcastingReviewServiceImpl

### 导入字段清单（15个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | liveBroadcastingNo | 直播货盘编号 | String | 关联货盘编号 |
| 3 | remark | 备注信息 | String | 备注 |
| 4 | customerName | 客户名称 | String | 客户（字典） |
| 5 | livePlatform | 直播平台 | String | 平台（字典） |
| 6 | liveCommission | 直播佣金 | BigDecimal | 直播佣金 |
| 7 | publicCommission | 公开佣金 | BigDecimal | 公开佣金 |
| 8 | rebateCommission | 返点佣金 | BigDecimal | 返点佣金 |
| 9 | livePrice | 直播价格 | String | 直播价 |
| 10 | sampleSendDate | 寄样日期 | LocalDateTime | 寄样日期 |
| 11 | liveStartDate | 开播日期 | LocalDateTime | 开播日期 |
| 12 | liveSales | 开播销量 | Integer | 销量 |
| 13 | repeatLiveDate | 复播日期 | LocalDateTime | 复播日期 |
| 14 | reviewStatus | 复盘状态 | String | 状态 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录
- 🔍 **特殊处理：**
  - liveBroadcastingNo → 转换为货盘ID

### 导入更新逻辑
- ✅ **已修复** - 只更新关联ID字段
- 📋 **更新字段：**
  - liveBroadcastingId（直播货盘ID）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 20. 【直播信息】ErpLiveBroadcastingInfoServiceImpl

### 导入字段清单（11个字段）

| 序号 | 字段名 | Excel列名 | 字段类型 | 说明 |
|-----|--------|----------|---------|------|
| 1 | no | 编号 | String | 业务编号（唯一标识） |
| 2 | customerName | 客户名称 | String | 客户（字典） |
| 3 | customerPosition | 客户职位 | String | 职位（字典） |
| 4 | customerWechat | 客户微信 | String | 微信号 |
| 5 | platformName | 平台名称 | String | 平台（字典） |
| 6 | customerAttribute | 客户属性 | String | 属性（字典） |
| 7 | customerCity | 客户城市 | String | 城市（字典） |
| 8 | customerDistrict | 客户区县 | String | 区县（字典） |
| 9 | userPortrait | 用户画像 | String | 画像 |
| 10 | recruitmentCategory | 招商类目 | String | 类目 |
| 11 | selectionCriteria | 选品标准 | String | 标准 |
| 12 | remark | 备注信息 | String | 备注 |

### 导入创建逻辑
- ✅ **正确** - 创建新记录

### 导入更新逻辑
- ✅ **已修复** - 逐字段判断更新
- 📋 **更新字段：** 全部11个字段
  - customerName（客户名称）
  - customerPosition（客户职位）
  - customerWechat（客户微信）
  - platformName（平台名称）
  - customerAttribute（客户属性）
  - customerCity（客户城市）
  - customerDistrict（客户区县）
  - userPortrait（用户画像）
  - recruitmentCategory（招商类目）
  - selectionCriteria（选品标准）
  - remark（备注信息）

### 逻辑正确性评估
✅ **完全正确** - 已修复，不会清空未导入的字段

---

## 📊 汇总统计

### 按修复状态分类

| 状态 | 数量 | 模块列表 |
|------|------|----------|
| ✅ **完全正确** | **20个** | 代发订单、批发订单、代发辅助、财务表、产品信息、组品信息、订货库存、样品表、记事本、中转销售、销售价格、团购货盘、团购复盘、团购信息、私播货盘、私播复盘、私播信息、直播货盘、直播复盘、直播信息 |

### ✅ 所有模块已修复完成

**🎉 所有20个模块的导入更新功能都已正确实现！**

---

## ✅ 修复完成状态

### 所有模块已修复完成

**🎉 所有20个模块的导入更新功能都已正确实现！**

### 测试验证（优先级：高）

对所有20个模块进行测试：
- [ ] 部分字段导入测试
- [ ] 空值不覆盖测试
- [ ] 特殊字段（计算字段、关联ID）测试
- [ ] 完整功能回归测试

---

**文档生成时间：** 2025-12-15  
**最后更新：** 2025-12-15（所有模块修复完成，包括数据清空问题修复）  
**下一步行动：** 请根据本文档在测试环境验证所有模块的导入更新功能  
**建议：** 进行完整的回归测试，确保所有功能正常

---

## 🔍 数据清空问题修复详情

### 修复的关键问题

**用户反馈的问题：**
- 导入Excel只包含"中转人员"列，不包含"售后状况"列
- 执行导入更新后："中转人员"正常更新，但"售后状况"被清空 ❌

**根本原因：**
代码直接设置字段值，没有判断Excel中该字段是否为null/空，导致：
- Excel中没有的列 → ImportVO中对应字段为null
- 代码直接执行 `setAfterSalesStatus(null)` → 清空了数据库中的值

**修复方案：**
所有字段更新前都进行判断：
```java
// ❌ 修复前（错误）
existDistribution.setAfterSalesStatus(importVO.getAfterSalesStatus());
existDistribution.setTransferPerson(importVO.getTransferPerson());

// ✅ 修复后（正确）
if (StrUtil.isNotBlank(importVO.getAfterSalesStatus())) {
    existDistribution.setAfterSalesStatus(importVO.getAfterSalesStatus());
}
if (StrUtil.isNotBlank(importVO.getTransferPerson())) {
    existDistribution.setTransferPerson(importVO.getTransferPerson());
}
```

### 已修复的方法

| 模块 | 方法名 | 修复的字段 | 状态 |
|------|--------|-----------|------|
| 代发订单 | importDistributionList | comboProductId, transferPerson | ✅ 已修复 |
| 代发订单 | importSaleAuditList | afterSalesStatus, transferPerson, saleOtherFees, saleAfterSalesAmount | ✅ 已修复 |
| 代发订单 | importPurchaseAuditList | afterSalesStatus, otherFees, purchaseAfterSalesAmount | ✅ 已修复 |
| 代发订单 | importLogisticsList | logisticsCompany, trackingNumber | ✅ 已修复 |

### 验证方法

**测试场景：**
1. 在数据库中创建一条记录，设置`售后状况 = "待处理"`、`中转人员 = "张三"`
2. 导出Excel，删除"售后状况"列
3. 修改"中转人员"为"李四"
4. 执行导入更新
5. 验证结果：
   - ✅ `中转人员` = "李四"（已更新）
   - ✅ `售后状况` = "待处理"（保持原值，未被清空）


