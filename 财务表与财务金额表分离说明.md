# 财务表与财务金额表功能分离说明

## 修改背景
根据用户需求，将财务表和财务金额表的功能进行分离：
- **财务表**：专门记录日常收支明细，不再自动影响财务金额表
- **财务金额表**：专门用于充值记录和余额查看

## 主要修改内容

### 1. 后端业务逻辑修改

#### ErpFinanceServiceImpl.java
- **createFinance()**: 移除自动更新财务金额表的逻辑
- **updateFinance()**: 移除修改时自动调整余额的逻辑  
- **deleteFinance()**: 移除删除时自动回滚余额的逻辑

#### ErpFinanceAmountService.java
- **updateBalance()**: 标记为废弃方法，不再使用

#### ErpFinanceAmountServiceImpl.java
- **updateBalance()**: 注释掉实现，不再使用
- **initUserFinanceAmount()**: 改为使用新的记录模式初始化
- **cleanupDuplicateFinanceAmountRecords()**: 废弃此方法，允许多条记录

### 2. 功能分离后的使用方式

#### 财务表 (erp_finance)
- **用途**: 记录日常收支明细
- **操作**: 新增、修改、删除财务记录
- **特点**: 操作不会影响财务金额表

#### 财务金额表 (erp_finance_amount)  
- **用途**: 专门记录充值操作和查看余额
- **操作**: 
  - 充值：通过充值接口创建充值记录
  - 消费：通过消费接口创建消费记录
  - 查看：通过余额查询接口获取各渠道余额
- **特点**: 每笔充值/消费都是独立记录，支持完整的资金流水追踪

### 3. 数据结构说明

#### 新的记录模式
- `channelType`: 渠道类型（微信、支付宝、银行卡等）
- `amount`: 操作金额
- `operationType`: 操作类型（1：充值，2：消费）
- `beforeBalance`: 操作前余额
- `afterBalance`: 操作后余额

#### 兼容性处理
- 保留原有字段但标记为 `@Deprecated`
- 原有API继续可用，内部使用新逻辑实现

## 优势

1. **职责清晰**: 财务表专注收支记录，财务金额表专注资金管理
2. **数据独立**: 两个表的操作互不影响，避免数据混乱
3. **审计完整**: 财务金额表保留完整的资金流水记录
4. **扩展性好**: 便于后续功能扩展和维护

## 使用建议

1. **财务记录**: 日常收支使用财务表，不会影响余额
2. **资金管理**: 充值、提现等资金操作使用财务金额表
3. **余额查询**: 通过财务金额表API获取实时余额
4. **数据迁移**: 如需要，可以通过脚本将历史数据迁移到新结构

## 注意事项

- 此修改向后兼容，不会影响现有功能
- 建议在生产环境部署前进行充分测试
- 如需要将财务表数据同步到财务金额表，需要额外开发迁移功能 